<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
<!--    <link rel="icon" type="image/svg+xml" href="/vite.svg" />-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spider Web Components - PDF Viewer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
    <script type="module" src="/components/pdf-viewer/pdf-viewer.js"></script>
    <link rel="stylesheet" href="/assets/application.css" />
  </head>
  <body>
    <div class="header">
      <h1>PDF Viewer</h1>
      <a href="https://github.com/rolemodel/spider" target="_blank" class="github-link">View on GitHub</a>
    </div>

    <div class="controls">
      <div class="thumbnail-wrapper" id="thumbnail-wrapper">
        <canvas id="thumbnail-canvas"></canvas>
        <div class="thumbnail-label">Click to Open PDF</div>
      </div>
    </div>

    <rm-pdf-viewer id="viewer" src="/data/the-veldt.pdf" theme-hue="217" theme-saturation="89"></rm-pdf-viewer>

    <script type="module">
      import * as pdfjsLib from 'pdfjs-dist';
      import pdfjsWorker from 'pdfjs-dist/build/pdf.worker.mjs?url';

      pdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;

      const viewer = document.getElementById('viewer');
      const thumbnailWrapper = document.getElementById('thumbnail-wrapper');
      const canvas = document.getElementById('thumbnail-canvas');

      async function renderThumbnail() {
        try {
          const pdfSrc = '/data/the-veldt.pdf';
          const loadingTask = pdfjsLib.getDocument(pdfSrc);
          const pdf = await loadingTask.promise;
          const page = await pdf.getPage(1);

          const scale = 0.5;
          const viewport = page.getViewport({ scale });

          canvas.width = viewport.width;
          canvas.height = viewport.height;

          const context = canvas.getContext('2d');
          const renderContext = {
            canvasContext: context,
            viewport: viewport
          };

          await page.render(renderContext).promise;
        } catch (error) {
          console.error('Error rendering thumbnail:', error);
        }
      }

      thumbnailWrapper.addEventListener('click', () => {
        viewer.open = true;
      });

      renderThumbnail();
    </script>
  </body>
</html>
