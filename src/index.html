<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
<!--    <link rel="icon" type="image/svg+xml" href="/vite.svg" />-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spider Web Components - PDF Viewer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
    <script type="module" src="/components/pdf-viewer/pdf-viewer.js"></script>
    <link rel="stylesheet" href="/assets/application.css" />
  </head>
  <body>
    <div class="header">
      <h1>PDF Viewer</h1>
      <a href="https://github.com/rolemodel/spider" target="_blank" class="github-link">View on GitHub</a>
    </div>

    <div class="theme-controls">
      <label for="hue-slider" class="theme-label">
        Theme Color: <span id="hue-value">217°</span>
      </label>
      <input type="range" id="hue-slider" min="0" max="360" value="217" class="hue-slider">
    </div>

    <div class="controls">
      <div class="thumbnail-wrapper" id="thumbnail-wrapper">
        <canvas id="thumbnail-canvas"></canvas>
        <div class="thumbnail-label">Default Close Button</div>
      </div>

      <div class="thumbnail-wrapper" id="thumbnail-wrapper-custom">
        <canvas id="thumbnail-canvas-custom"></canvas>
        <div class="thumbnail-label">Custom Close Button</div>
      </div>

      <div class="thumbnail-wrapper error-thumbnail" id="error-thumbnail">
        <div class="error-thumbnail-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10" stroke-width="2"/>
            <path d="M12 8v4m0 4h.01" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="thumbnail-label error-label">Click to Test Error State</div>
      </div>
    </div>

    <rm-pdf-viewer id="viewer" src="/data/the-veldt.pdf" theme-hue="217" theme-saturation="89"></rm-pdf-viewer>

    <rm-pdf-viewer id="viewer-custom" src="/data/the-veldt.pdf" theme-hue="142" theme-saturation="76">
      <button slot="close-button" class="custom-close-btn">
        ← Back to Demos
      </button>
    </rm-pdf-viewer>

    <script type="module">
      import * as pdfjsLib from 'pdfjs-dist';
      import pdfjsWorker from 'pdfjs-dist/build/pdf.worker.mjs?url';

      pdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;

      const viewer = document.getElementById('viewer');
      const viewerCustom = document.getElementById('viewer-custom');
      const thumbnailWrapper = document.getElementById('thumbnail-wrapper');
      const thumbnailWrapperCustom = document.getElementById('thumbnail-wrapper-custom');
      const canvas = document.getElementById('thumbnail-canvas');
      const errorThumbnail = document.getElementById('error-thumbnail');
      const hueSlider = document.getElementById('hue-slider');
      const hueValue = document.getElementById('hue-value');
      const canvasCustom = document.getElementById('thumbnail-canvas-custom');

      async function renderThumbnail(canvasEl) {
        try {
          const pdfSrc = '/data/the-veldt.pdf';
          const loadingTask = pdfjsLib.getDocument(pdfSrc);
          const pdf = await loadingTask.promise;
          const page = await pdf.getPage(1);

          const scale = 0.5;
          const viewport = page.getViewport({ scale });

          canvasEl.width = viewport.width;
          canvasEl.height = viewport.height;

          const context = canvasEl.getContext('2d');
          const renderContext = {
            canvasContext: context,
            viewport: viewport
          };

          await page.render(renderContext).promise;
        } catch (error) {
          console.error('Error rendering thumbnail:', error);
        }
      }

      thumbnailWrapper.addEventListener('click', () => {
        viewer.src = '/data/the-veldt.pdf';
        viewer.open = true;
      });

      errorThumbnail.addEventListener('click', () => {
        viewer.src = '/non-existent-file.pdf';
        viewer.open = true;
      });

      thumbnailWrapperCustom.addEventListener('click', () => {
        viewerCustom.open = true
      })

      const customCloseBtn = document.querySelector('.custom-close-btn')
      customCloseBtn.addEventListener('click', () => {
        viewerCustom.open = false
      })

      renderThumbnail(canvas)
      renderThumbnail(canvasCustom)
      hueSlider.addEventListener('input', (e) => {
        const hue = e.target.value;
        viewer.themeHue = parseInt(hue);
        hueValue.textContent = `${hue}°`;
      });

      renderThumbnail();
    </script>
  </body>
</html>
